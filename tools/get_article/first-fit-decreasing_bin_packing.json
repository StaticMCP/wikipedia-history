{
  "content": [
    {
      "type": "text",
      "text": "# First-fit-decreasing bin packing\n\nFirst-fit-decreasing (FFD) is an algorithm for bin packing. Its input is a list of items of different sizes. Its output is a packing - a partition of the items into bins of fixed capacity, such that the sum of sizes of items in each bin is at most the capacity. Ideally, we would like to use as few bins as possible, but minimizing the number of bins is an NP-hard problem, so we use an approximately-optimal heuristic.\nDescription\nThe FFD algorithm works as follows.\n* Order the items from largest to smallest.\n* Open a new empty bin, bin #1.\n* For each item from largest to smallest, find the first bin into which the item fits, if any.\n** If such a bin is found, put the new item in it.\n** Otherwise, open a new empty bin put the new item in it.\nIn short: FFD orders the items by descending size, and then calls first-fit bin packing.\nAn equivalent description of the FFD algorithm is as follows.\n* Order the items from largest to smallest.\n* While there are remaining items:\n** Open a new empty bin.\n** For each item from largest to smallest:\n*** If it can fit into the current bin, insert it.\nIn the standard description, we loop over the items once, but keep many open bins. In the equivalent description, we loop over the items many times, but keep only a single open bin each time.\nPerformance analysis\nThe performance of FFD was analyzed in several steps. Below, FFD(S,C) denotes the number of bins used by FFD for input set S and bin-capacity C.\n* In 1973, D.S. Johnson proved in his doctoral thesis that FFD(S,C) \\leq 11/9 \\mathrm{OPT}(S,C) +4 for any instance S and capacity C.\n* In 1985, B.S. Backer gave a slightly simpler proof and showed that the additive constant is not more than 3.\n* Yue Minyi proved that FFD(S,C) \\leq 11/9 \\mathrm{OPT}(S,C) +1 in 1991 and, in 1997, improved this analysis to FFD(S,C) \\leq 11/9 \\mathrm{OPT}(S,C) + 7/9 together with Li Rongheng.\n* In 2007 György Dósa proved the tight bound FFD(S,C) \\leq 11/9 \\mathrm{OPT}(S,C) +6/9 and presented an example for which FFD(S,C) = 11/9 \\mathrm{OPT}(S,C) +6/9.\nWorst-case example\nThe lower bound example given in by Dósa is the following: Consider the two bin configurations:\n* B_1 := \\{1/2+\\varepsilon, 1/4+\\varepsilon, 1/4 - 2\\varepsilon\\}  ;\n* B_2 := \\{1/4 + 2\\varepsilon,1/4 + 2\\varepsilon, 1/4-2\\varepsilon, 1/4 - 2\\varepsilon\\}  .\nIf there are 4 copies of B_1 and 2 copies of B_2 in the optimal solution, FFD will compute the following bins:\n* 4 bins with configuration \\{1/2+\\varepsilon,1/4+2\\varepsilon\\},\n* 1 bin with configuration \\{1/4+\\varepsilon,1/4+\\varepsilon,1/4+\\varepsilon\\},\n* 1 bin with configuration \\{1/4+\\varepsilon,1/4-2\\varepsilon,1/4-2\\varepsilon,1/4-2\\varepsilon\\},\n* 1 bin with configuration \\{1/4-2\\varepsilon,1/4-2\\varepsilon,1/4-2\\varepsilon,1/4-2\\varepsilon\\},\n* 1 one final bin with configuration \\{1/4-2\\varepsilon\\},\nThat is, 8 bins total, while the optimum has only 6 bins. Therefore, the upper bound is tight, because 11/9 \\cdot 6 + 6/9 = 72/9 = 8.\nThis example can be extended to all sizes of \\text{OPT}(S,C): in the optimal configuration there are 9k+6 bins: 6k+4 of type B1 and 3k+2 of type B2. But FFD needs at least 11k+8 bins, which is \\frac{11}{9}(6k+4+3k+2)+\\frac{6}{9}.\nPerformance with divisible item sizes\nAn important special case of bin-packing is that which the item sizes form a divisible sequence (also called factored). A special case of divisible item sizes occurs in memory allocation in computer systems, where the item sizes are all powers of 2. In this case, FFD always finds the optimal packing.\nMonotonicity properties\nContrary to intuition, FFD(S,C) is not a monotonic function of C.  Similarly, FFD(S,C) is not a monotonic function of the sizes of items in S: it is possible that an item shrinks in size, but the number of bins increases.\nHowever, the FFD algorithm has an \"asymptotic monotonicity\" property, defined as follows.\n* For every instance S and integer m, let MinCap(S,m) be the smallest capacity C such that OPT(S,C)\\leq m\n* For every integer m, let MinRatio(m) be the infimum of the numbers r≥1 such that, for all input sets S, FFD(S,r\\cdot \\text{MinCap}(S,m))\\leq m. This is the amount by which we need to \"inflate\" the bins such that FFD attains the optimal number of bins.\n* Then, for every input S and for every r ≥ MinRatio(m), FFD(S,r\\cdot \\text{MinCap}(S,m))\\leq m. This shows, in particular, that the infimum in the above definition can be replaced by minimum.\nExamples\nFor example, suppose the input is: 44, 24, 24, 22, 21, 17, 8, 8, 6, 6. With capacity 60, FFD packs 3 bins:\n* 44, 8, 8;\n* 24, 24, 6, 6;\n* 22, 21, 17.\nBut with capacity 61, FFD packs 4 bins:\n* 44, 17;\n* 24, 24, 8;\n* 22, 21, 8, 6;\n* 6.\nThis is because, with capacity 61, the 17 fits into the first bin, and thus blocks the way to the following 8, 8.\nAs another example, suppose the inputs are: 51,  28, 28, 28, 27,  25, 12, 12,  10, 10, 10, 10, 10, 10, 10, 10. With capacity 75, FFD packs 4 bins:\n* 51, 12, 12\n* 28, 28, 10\n* 28, 27, 10, 10\n* 25, 10, 10, 10, 10, 10\nBut with capacity 76, it needs 5 bins:\n* 51, 25\n* 28, 28, 12\n* 28, 27, 12\n* 10, 10, 10, 10, 10, 10, 10\n* 10\nConsider the above example with capacity 60. If the 17 becomes 16, then the resulting packing is:\n*44, 16;\n* 24, 24, 8;\n* 22, 21, 8, 6;\n* 6.\nModified first-fit-decreasing\nModified first fit decreasing (MFFD) improves on FFD for items larger than half a bin by classifying items by size into four size classes large, medium, small, and tiny, corresponding to items with size > 1/2 bin, > 1/3 bin, > 1/6 bin, and smaller items respectively. Then it proceeds through five phases:\n# Allot a bin for each large item, ordered largest to smallest.\n# Proceed forward through the bins. On each: If the smallest remaining medium item does not fit, skip this bin. Otherwise, place the largest remaining medium item that fits.\n# Proceed backward through those bins that do not contain a medium item. On each: If the two smallest remaining small items do not fit, skip this bin. Otherwise, place the smallest remaining small item and the largest remaining small item that fits.\n# Proceed forward through all bins. If the smallest remaining item of any size class does not fit, skip this bin. Otherwise, place the largest item that fits and stay on this bin.\n# Use FFD to pack the remaining items into new bins.\nThis algorithm was first studied by Johnson and Garey in 1985, where they proved that MFFD(S,C) \\leq (71/60)\\mathrm{OPT}(S,C) + (31/6). This bound was improved in the year 1995 by Yue and Zhang who proved that MFFD(S,C) \\leq (71/60)\\mathrm{OPT}(S,C) + 1.\nOther variants\nBest-fit-decreasing (BFD) is very similar to FFD, except that after the list is sorted, it is processed by best-fit bin packing. Its asymptotic approximation ratio is the same as FFD - 11/9.\nImplementations\n* Python: The [https://github.com/erelsgl/prtpy prtpy package] contains [https://github.com/erelsgl/prtpy/blob/main/prtpy/packing/first_fit.py an implementation of first-fit decreasing].\nSee also\n* Multifit algorithm - an algorithm for identical-machines scheduling, which uses FFD as a subroutine.\nReferences"
    }
  ]
}