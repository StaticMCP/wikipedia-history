{
  "content": [
    {
      "type": "text",
      "text": "# Boot Service Discovery Protocol\n\nBoot Service Discovery Protocol (BSDP) is an Apple-developed, standards-conforming extension of  DHCP.  It allows Macintosh computers to boot from bootable images on a network instead of local storage media such as CD, DVD, or hard disk.  The DHCP options used are the \"vendor-specific information\" option (number 43) and the \"vendor class identifier\" option (number 60).\nThere are three versions of BSDP, though usually version 1.0 is used.  All versions enable a client to choose from several bootable images offered by a server.\nThe [https://github.com/apple-oss-distributions/bootp reference implementation] of BSDP is Darwin's BOOTP server, which is part of Mac OS's  NetBoot feature.\nDescription\nContents of DHCP Vendor Class Identifier\nThe DHCP server and client send a vendor class option that contains an ASCII-encoded string with three parts delimited by a / character.  The first part is AAPLBSDPC, which advertises BSDP capability.  The second part is the client's architecture (\"ppc\" or \"i386\").  The third part is a system identifier.  For example, an Intel-based iMac sends\nAAPLBSDPC/i386/iMac4,1\nas its vendor class.  A list of Microsoft vendor classes can be found [http://support.microsoft.com/kb/266675 here].\nContents of DHCP Vendor Specific Information Options\nDHCP Option 43 is reserved for vendor specific information. This information is stored in the following format:\nCode   Len   Vendor-specific information\n+-----+-----+-----+-----+---\n|  43 |  n  |  i1 |  i2 | ...\n+-----+-----+-----+-----+---\nIf the vendor wants to convey multiple options within this option field, this is done with encapsulated vendor-specific extensions. Vendor encapsulated extensions contain one or more concatenated fields.  Each field consists of:\n{| class=\"wikitable\"\n|-- class=\"hintergrundfarbe6\"\n!Byte Position\n!Content\n|-\n|0\n|Type of field\n|-\n|1\n|Length n of field\n|-\n|2 to n-2\n|Data\n|}\nThe following table describes the possible field types.  All numeric fields are interpreted as unsigned and Big Endian integers.\n{| class=\"wikitable\"\n|-- class=\"hintergrundfarbe6\"\n!Type\n!Meaning\n!Data type\n|-\n|1\n|Message Type\n|8 Bit int\n* 0x00: none\n* 0x01: LIST\n* 0x02: SELECT\n* 0x03: error\n|-\n|2\n|BSDP Version used\n|16 Bit int\n* 0x0000: Version 0.0\n* 0x0100: Version 1.0\n* 0x0101: Version 1.1\n|-\n|3\n|Server Identifier\n|IP address of the server, one byte per component: c0 a8 64 01 represents 192.168.100.1\n|-\n|4\n|Server Priority\n|16 Bit int\n|-\n|5\n|Port for Response\n|16 Bit int\n|-\n|6\n|\"boot image list path\"\n|String\n|-\n|7\n|ID of Standard Boot Image\n|32 Bit int\n(According to [http://support.apple.com/kb/HT3115 Apple's documentation], the boot image ID can range up to 65535. This comprises 16 bits; however, 32 bits are reserved. In all observed IDs, the most significant 16 bits are always 1000 0001 0000 0000 (0x8100), which probably indicates the type and version of the operating system to be booted.)\n|-\n|8\n|ID of Selected Boot Image\n|32 Bit int\n|-\n|9\n|List of Boot Images\n|?\n|-\n|10\n|\"netboot 1.0 firmware\"\n|?\n|-\n|11\n|Error List for Image Attribute\n|?\n|-\n|12\n|Maximum Message Size\n|?\n|-\n|128\n|\"shadow mount path\"\n|String (URL)\nHere is possible to specify a network-accessible mount where data will be written after a successful boot. If this field is not specified and no storage medium is available locally on the client, then the boot process for Mac OS X is aborted.  Officially, Mac OS X only supports AFP shadow mount paths. However, NFS may be used after a modifying of the startup files of the system.\n|-\n|129\n|\"shadow file path\"\n|String (URL)\n|-\n|130\n|\"machine name\" (Name of system to boot?)\n|String\n|}\nExample\nThe following example illustrates the construction of the Vendor Encapsulated Option:\nThe first field here, 01 01 02, means that the packet is a BSDP \"SELECT\" message.  The 01 declares that field specifies the BSDP Message Type.  The next 01 indicates that the field contents are one byte long â€” 02 is the code for \"SELECT\".\nThe following 08 04 81 00 07 e5 means that the boot image with the ID 2164262885 is selected.\nFinally, 82 0a 4e 65 74 42 6f 6f 74 30 30 31 means that a string with 0x0a = 10 characters, namely \"NetBoot001\", is the name of the system to boot.\nSources\n* [https://github.com/apple-oss-distributions/bootp/raw/main/Documentation/BSDP.doc BSDP documentation] from Apple's bootpd\n* several conversations captured with Wireshark\n* Source code of Darwin's BOOTP server, https://github.com/apple-oss-distributions/bootp\nReferences"
    }
  ]
}