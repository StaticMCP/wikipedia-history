{
  "content": [
    {
      "type": "text",
      "text": "# Flame (malware)\n\nFlame, also known as Flamer, sKyWIper, and Skywiper, is modular computer malware discovered in 2012 that attacks computers running the Microsoft Windows operating system. The program is used for targeted cyber espionage in Middle Eastern countries.\nIts discovery was announced on 28 May 2012 by the MAHER Center of the Iranian National Computer Emergency Response Team (CERT), Kaspersky Lab and CrySyS Lab of the Budapest University of Technology and Economics. The last of these stated in its report that Flame \"is certainly the most sophisticated malware we encountered during our practice; arguably, it is the most complex malware ever found.\" Flame can spread to other systems over a local area network (LAN). It can record audio, screenshots, keyboard activity and network traffic. The program also records Skype conversations and can turn infected computers into Bluetooth beacons which attempt to download contact information from nearby Bluetooth-enabled devices. This data, along with locally stored documents, is sent on to one of several command and control servers that are scattered around the world. The program then awaits further instructions from these servers.\nAccording to estimates by Kaspersky in May 2012, Flame had initially infected approximately 1,000 machines, with victims including governmental organizations, educational institutions and private individuals. At that time 65% of the infections happened in Iran, Israel, Palestine, Sudan, Syria, Lebanon, Saudi Arabia, and Egypt, with a \"huge majority of targets\" within Iran. Flame has also been reported in Europe and North America. Flame supports a \"kill\" command which wipes all traces of the malware from the computer. The initial infections of Flame stopped operating after its public exposure, and the \"kill\" command was sent.\nFlame is linked to the Equation Group by Kaspersky Lab. However, Costin Raiu, the director of Kaspersky Lab's global research and analysis team, believes the group only cooperates with the creators of Flame and Stuxnet from a position of superiority: \"Equation Group are definitely the masters, and they are giving the others, maybe, bread crumbs. From time to time they are giving them some goodies to integrate into Stuxnet and Flame.\"\nRecent research has indicated that Flame is positioned to be remembered as one of the most significant and intricate cyber-espionage tools in history. Using a sophisticated strategy, Flame managed to penetrate numerous computers across the Middle East by falsifying an authentic Microsoft security certificate.\nIn 2019, researchers Juan Andres Guerrero-Saade and Silas Cutler announced their discovery of the resurgence of Flame. The attackers used 'timestomping' (changing timestamps and dates of files) to make the new samples look like they were created before the 'suicide' command. However, a compilation error included the real compilation date (). The new version (dubbed 'Flame 2.0' by the researchers) includes new encryption and obfuscation mechanisms to hide its functionality.\nHistory\nFlame (a.k.a. Da Flame) was identified in May 2012 by the MAHER Center of the Iranian National CERT, Kaspersky Lab and CrySyS Lab (Laboratory of Cryptography and System Security) of the Budapest University of Technology and Economics when Kaspersky Lab was asked by the United Nations International Telecommunication Union to investigate reports of a virus affecting Iranian Oil Ministry computers. As Kaspersky Lab investigated, they discovered an MD5 hash and filename that appeared only on customer machines from Middle Eastern nations. After discovering more pieces, researchers dubbed the program \"Flame\" after one of the main modules inside the toolkit .\nAccording to Kaspersky, Flame had been operating in the wild since at least February 2010. CrySyS Lab reported that the file name of the main component was observed as early as December 2007. However, its creation date could not be determined directly, as the creation dates for the malware's modules are falsely set to dates as early as 1994.\nComputer experts consider it the cause of an attack in April 2012 that caused Iranian officials to disconnect their oil terminals from the Internet. At the time the Iranian Students News Agency referred to the malware that caused the attack as \"Wiper\", a name given to it by the malware's creator. However, Kaspersky Lab believes that Flame may be \"a separate infection entirely\" from the Wiper malware. Due to the size and complexity of the program—described as \"twenty times\" more complicated than Stuxnet—the Lab stated that a full analysis could require as long as ten years.\nOn 28 May, Iran's CERT announced that it had developed a detection program and a removal tool for Flame, and had been distributing these to \"select organizations\" for several weeks. After Flame's exposure in news media, Symantec reported on 8 June that some Flame command and control (C&C) computers had sent a \"suicide\" command to infected PCs to remove all traces of Flame. All copies of the program and any related files were deleted.\nAccording to estimates by Kaspersky in May 2012, initially Flame had infected approximately 1,000 machines, with victims including governmental organizations, educational institutions and private individuals. At that time the countries most affected were Iran, Israel, the Palestinian Territories, Sudan, Syria, Lebanon, Saudi Arabia, and Egypt.\nA sample of the Flame malware is available at [https://github.com/phoenixlzx/flame-sourcecode GitHub].\nOperation\n{| class=\"wikitable\" style=\"float: right; margin:24px; margin-top: 0px; \"\n! |Name || Description\n|-\n|+List of code names for various families of modules in Flame's source code and their possible purpose\n|-\n|Flame\n|Modules that perform attack functions\n|-\n|Boost\n|Information gathering modules\n|-\n|Flask\n|A type of attack module\n|-\n|Jimmy\n|A type of attack module\n|-\n|Munch\n|Installation and propagation modules\n|-\n|Snack\n|Local propagation modules\n|-\n|Spotter\n|Scanning modules\n|-\n|Transport\n|Replication modules\n|-\n|Euphoria\n|File leaking modules\n|-\n|Headache\n|Attack parameters or properties\n|}\nFlame is an uncharacteristically large program for malware at 20&nbsp;megabytes.  It is written partly in the Lua scripting language with compiled C++ code linked in, and allows other attack modules to be loaded after initial infection. The malware uses five different encryption methods and an SQLite database to store structured information. The method used to inject code into various processes is stealthy, in that the malware modules do not appear in a listing of the modules loaded into a process and malware memory pages are protected with READ, WRITE and EXECUTE permissions that make them inaccessible by user-mode applications. The internal code has few similarities with other malware, but exploits two of the same security vulnerabilities used previously by Stuxnet to infect systems. The malware determines what antivirus software is installed, then customises its own behaviour (for example, by changing the filename extensions it uses) to reduce the probability of detection by that software. Additional indicators of compromise include mutex and registry activity, such as installation of a fake audio driver which the malware uses to maintain persistence on the compromised system.\nFlame is not designed to deactivate automatically, but supports a \"kill\" function that makes it eliminate all traces of its files and operation from a system on receipt of a module from its controllers.\nFlame was signed with a fraudulent certificate purportedly from the Microsoft Enforced Licensing Intermediate PCA certificate authority. The malware authors identified a Microsoft Terminal Server Licensing Service certificate that inadvertently was enabled for code signing and that still used the weak MD5 hashing algorithm, then produced a counterfeit copy of the certificate that they used to sign some components of the malware to make them appear to have originated from Microsoft. A successful collision attack against a certificate was previously demonstrated in 2008,\nbut Flame implemented a new variation of the chosen-prefix collision attack.\n{| class=\"wikitable collapsible collapsed\"  style=\"float: left;\"\n! style=\"background: #efefef;\" scope=\"col\" width=\"150\" |Property\n! style=\"background: #efefef;\" scope=\"col\" width=\"300\" |Value\n|-\n|Compromised Microsoft certificate using the weak MD5 algorithm, and the unintended code-signing usage\n|-\n|Version\n|V3\n|-\n|Serial number\n|3a ab 11 de e5 2f 1b 19 d0 56\n|-\n|Signature algorithm\n|bgcolor=\"#faa\"|md5RSA\n|-\n|Signature hash algorithm\n|bgcolor=\"#faa\"|md5\n|-\n|Issuer\n|CN = Microsoft Root Authority, OU = Microsoft Corporation, OU = Copyright (c) 1997 Microsoft Corp.\n|-\n|Valid from\n|Thursday, 10 December 2009 11:55:35 AM\n|-\n|Valid to\n|Sunday, 23 October 2016 6:00:00 PM\n|-\n|Subject\n|CN = Microsoft Enforced Licensing Intermediate PCA, OU = Copyright (c) 1999 Microsoft Corp., O = Microsoft Corporation, L = Redmond, S = Washington, C = US\n|-\n|Public key\n|30 82 01 0a 02 82 01 01 00 fa c9 3f 35 cb b4 42 4c 19 a8 98 e2 f4 e6 ca c5 b2 ff e9 29 25 63 9a b7 eb b9 28 2b a7 58 1f 05 df d8 f8 cf 4a f1 92 47 15 c0 b5 e0 42 32 37 82 99 d6 4b 3a 5a d6 7a 25 2a 9b 13 8f 75 75 cb 9e 52 c6 65 ab 6a 0a b5 7f 7f 20 69 a4 59 04 2c b7 b5 eb 7f 2c 0d 82 a8 3b 10 d1 7f a3 4e 39 e0 28 2c 39 f3 78 d4 84 77 36 ba 68 0f e8 5d e5 52 e1 6c e2 78 d6 d7 c6 b9 dc 7b 08 44 ad 7d 72 ee 4a f4 d6 5a a8 59 63 f4 a0 ee f3 28 55 7d 2b 78 68 2e 79 b6 1d e6 af 69 8a 09 ba 39 88 b4 92 65 0d 12 17 09 ea 2a a4 b8 4a 8e 40 f3 74 de a4 74 e5 08 5a 25 cc 80 7a 76 2e ee ff 21 4e b0 65 6c 64 50 5c ad 8f c6 59 9b 07 3e 05 f8 e5 92 cb d9 56 1d 30 0f 72 f0 ac a8 5d 43 41 ff c9 fd 5e fa 81 cc 3b dc f0 fd 56 4c 21 7c 7f 5e ed 73 30 3a 3f f2 e8 93 8b d5 f3 cd 0e 27 14 49 67 94 ce b9 25 02 03 01 00 01\n|-\n|Enhance key usage\n|bgcolor=\"#faa\"|Code Signing (1.3.6.1.5.5.7.3.3)Key Pack Licenses (1.3.6.1.4.1.311.10.6.1)License Server Verification (1.3.6.1.4.1.311.10.6.2)\n|-\n|Authority identifier\n|KeyID=5b d0 70 ef 69 72 9e 23 51 7e 14 b2 4d 8e ff cb | Certificate Issuer: CN=Microsoft Root Authority, OU=Microsoft Corporation, OU=Copyright (c) 1997 Microsoft Corp.| Certificate SerialNumber=00 c1 00 8b 3c 3c 88 11 d1 3e f6 63 ec df 40\n|-\n|Subject key identifier\n|6a 97 e0 c8 9f f4 49 b4 89 24 b3 e3 d1 a8 22 86 aa d4 94 43\n|-\n|Key usage\n|Digital SignatureCertificate SigningOff-line CRL SigningCRL Signing (86)\n|-\n|Basic constraints\n|Subject Type=CAPath Length Constraint=None\n|-\n|Thumbprint algorithm\n|sha1\n|-\n|Thumbprint\n|2a 83 e9 02 05 91 a5 5f c6 dd ad 3f b1 02 79 4c 52 b2 4e 70\n|-\n|}\nDeployment\nLike the previously known cyber weapons Stuxnet and Duqu, it is employed in a targeted manner and can evade current security software through rootkit functionality. Once a system is infected, Flame can spread to other systems over a local network or via USB stick. It can record audio, screenshots, keyboard activity and network traffic. The program also records Skype conversations and can turn infected computers into Bluetooth beacons which attempt to download contact information from nearby Bluetooth enabled devices. This data, along with locally stored documents, is sent on to one of several command and control servers that are scattered around the world. The program then awaits further instructions from these servers.\nUnlike Stuxnet, which was designed to sabotage an industrial process, Flame appears to have been written purely for espionage. It does not appear to target a particular industry, but rather is \"a complete attack toolkit designed for general cyber-espionage purposes\".\nUsing a technique known as sinkholing, Kaspersky demonstrated that \"a huge majority of targets\" were within Iran, with the attackers particularly seeking AutoCAD drawings, PDFs, and text files. Computing experts said that the program appeared to be gathering technical diagrams for intelligence purposes.\nA network of 80 servers across Asia, Europe and North America has been used to access the infected machines remotely.\nOrigin\nOn 19 June 2012, The Washington Post published an article claiming that Flame was jointly developed by the U.S. National Security Agency, CIA and Israel's military at least five years prior. The project was said to be part of a classified effort code-named Olympic Games, which was intended to collect intelligence in preparation for a cyber-sabotage campaign aimed at slowing Iranian nuclear efforts.\nAccording to Kaspersky's chief malware expert, \"the geography of the targets and also the complexity of the threat leaves no doubt about it being a nation-state that sponsored the research that went into it.\" Kaspersky initially said that the malware bears no resemblance to Stuxnet, although it may have been a parallel project commissioned by the same attackers.\nAfter analysing the code further, Kaspersky later said that there is a strong relationship between Flame and Stuxnet; the early version of Stuxnet contained code to propagate via USB drives that is nearly identical to a Flame module that exploits the same zero-day vulnerability.\nIran's CERT described the malware's encryption as having \"a special pattern which you only see coming from Israel\". The Daily Telegraph reported that due to Flame's apparent targets—which included Iran, Syria, and the West Bank—Israel became \"many commentators' prime suspect\". Other commentators named the U.S. as possible perpetrators. Richard Silverstein, a commentator critical of Israeli policies, claimed that he had confirmed with a \"senior Israeli source\" that the malware was created by Israeli computer experts. The Jerusalem Post wrote that Israel's Vice Prime Minister Moshe Ya'alon appeared to have hinted that his government was responsible, but an Israeli spokesperson later denied that this had been implied. Unnamed Israeli security officials suggested that the infected machines found in Israel may imply that the virus could be traced to the U.S. or other Western nations. The U.S. has officially denied responsibility.\nA leaked NSA document mentions that dealing with Iran's discovery of FLAME is an NSA and GCHQ jointly-worked event.\nSee also\n* Cybercrime\n* Cyberwarfare\n* Cyber security standards\n* Cyberterrorism\n* Digital privacy\n* Operation High Roller\nNotes\nReferences"
    }
  ]
}